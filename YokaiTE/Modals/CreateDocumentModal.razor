@using YokaiTE.Component
@using YokaiTE.Data

@if (Visible)
{
    <div class="modal-back">
        <div class="modal">
            <div class="modal-top-container">
                <span class="modal-name">Criar novo arquivo</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <g clip-path="url(#clip0_2_642)">
                        <path d="M12.5 3.5L3.5 12.5" stroke="#181818" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M12.5 12.5L3.5 3.5" stroke="#181818" stroke-linecap="round" stroke-linejoin="round" />
                    </g>
                    <defs>
                        <clipPath id="clip0_2_642">
                            <rect width="16" height="16" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            </div>
            <div class="first-input-row">
                <MudTextField ShrinkLabel @bind-Value="Title" Placeholder="Titulo" Variant="Variant.Text"></MudTextField>
                <MudSelect @bind-Value="BackgroundColor">
                    @* @foreach (var state in _states)
                    {
                        <MudSelectItem Value="state">@state</MudSelectItem>
                    } *@
                </MudSelect>
            </div>
            <div class="w-100">
                <NormalSelect Label="Idioma"
                               Options="IdiomaOptions"
                               @bind-Value="Language" />
            </div>
            <div class="switch-container">
                <NormalSwitch Label="Quebra de página" @bind-Value="PageBreak" />
                <NormalSwitch Label="Interpretar markdown" @bind-Value="ParseMarkdown" />

            </div>
            <div class="button-container">
                <button @onclick="OnCancel" class="cancel-btn">Cancelar</button>
                <button @onclick="OnConfirm" class="confirm-btn">Criar</button>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool Visible { get; set; }
    [Parameter] public EventCallback<bool> VisibleChanged { get; set; }
    [Parameter] public EventCallback<Document> OnSave { get; set; }
    
    private List<NormalSelect.SelectOption> IdiomaOptions =
    [
        new("pt-BR","pt-BR"),
        new("en-US","en-US"),
        new("es-ES","es-ES")
    ];

    private string Title { get; set; } = string.Empty;
    private string Language { get; set; } = string.Empty;
    private string BackgroundColor { get; set; } = string.Empty;
    private bool ParseMarkdown;
    private bool PageBreak;
    private async Task OnConfirm()
    {
        await OnSave.InvokeAsync(new Document
        {
            Title = Title,
            CreatedAt = DateTime.Now,
            LastModified = DateTime.Now
        });
        await VisibleChanged.InvokeAsync(false);
    }

    private async Task OnCancel()
    {
        await VisibleChanged.InvokeAsync(false);
    }
}